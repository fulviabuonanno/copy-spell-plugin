<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Instrument Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      font-size: 12px;
      padding: 16px;
      background: #f5f5f5;
      color: #000;
      min-height: 100vh;
      height: 100%;
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
    }

    /* 8-Bit Button Styling */
    .sparkle-button {
        position: fixed;
        bottom: 16px;
        left: 50%; /* Center horizontally */
        transform: translateX(-50%); /* Center horizontally */
        width: fit-content; /* Adjust width to content */
        appearance: none;
        background: #000000; /* Black background */
        padding: 0.5rem 1rem; /* Smaller padding */
        border: none;
        border-radius: 0; /* Square corners */
        color: white;
        font-size: 0.75rem; /* Smaller font size */
        text-transform: uppercase;
        cursor: pointer;
        font-family: 'Press Start 2P', cursive;
        image-rendering: pixelated;
        /* Pixel art borders for depth */
        box-shadow: 
            inset -4px -4px 0px 0px #333333,
            inset 4px 4px 0px 0px #666666,
            0 0 0 4px #0f172a,
            0 0 0 8px #fff;
        transition: transform 0.1s steps(2), box-shadow 0.1s steps(2);
        z-index: 100; /* Ensure it's on top */
        overflow: visible;
    }

    /* Hover state */
    .sparkle-button:hover {
        transform: translateY(-4px);
        box-shadow: 
            inset -4px -4px 0px 0px #333333,
            inset 4px 4px 0px 0px #666666,
            0 4px 0 4px #0f172a,
            0 4px 0 8px #fff;
    }

    /* Active/Click state */
    .sparkle-button:active {
        transform: translateY(0px);
        background: #111111;
        box-shadow: 
            inset -2px -2px 0px 0px #333333,
            inset 2px 2px 0px 0px #666666,
            0 0 0 4px #0f172a,
            0 0 0 8px #fff;
    }

    /* Sparkle Elements - Pixelated */
    .sparkle {
        position: absolute;
        pointer-events: none;
        z-index: -1;
        fill: #fbbf24;
        /* Use steps() for jerky, frame-by-frame animation */
        animation-timing-function: steps(4, end);
    }

    /* 8-bit Animations 
        - Color flashing (Gold -> White -> Gold)
    */
    @keyframes sparkle-anim {
        0% { opacity: 0; transform: translate(0, 0); }
        25% { opacity: 1; transform: translate(var(--tx1), var(--ty1)); fill: #fbbf24; }
        50% { opacity: 1; transform: translate(var(--tx2), var(--ty2)); fill: #ffffff; } /* Flash white */
        75% { opacity: 1; transform: translate(var(--tx3), var(--ty3)); fill: #fbbf24; }
        100% { opacity: 0; transform: translate(var(--tx3), var(--ty3)); }
    }
    
    @keyframes blink {
        0%, 100% { opacity: 1; fill: #fbbf24; }
        50% { opacity: 0.5; fill: #ffffff; }
    }

    /* Specific Sparkle Positioning & Movement Paths */
    .sparkle-1 {
        top: -8px; left: -8px; width: 16px; height: 16px;
        --tx1: -12px; --ty1: -12px;
        --tx2: -20px; --ty2: -6px;
        --tx3: -15px; --ty3: -25px;
        animation: sparkle-anim 1.0s infinite;
    }
    .sparkle-2 {
        top: 0px; right: -12px; width: 12px; height: 12px;
        --tx1: 12px; --ty1: -5px;
        --tx2: 18px; --ty2: -15px;
        --tx3: 8px; --ty3: -25px;
        animation: sparkle-anim 1.4s infinite 0.2s;
    }
    .sparkle-3 {
        bottom: -8px; right: -8px; width: 16px; height: 16px;
        --tx1: 10px; --ty1: 10px;
        --tx2: 20px; --ty2: 5px;
        --tx3: 15px; --ty3: 25px;
        animation: sparkle-anim 1.2s infinite 0.5s;
    }
    .sparkle-4 {
        bottom: 0px; left: -12px; width: 12px; height: 12px;
        --tx1: -10px; --ty1: 5px;
        --tx2: -15px; --ty2: 15px;
        --tx3: -5px; --ty3: 25px;
        animation: sparkle-anim 1.6s infinite 0.1s;
    }
    .sparkle-5 {
        top: 40%; left: -14px; width: 10px; height: 10px;
        --tx1: -8px; --ty1: -4px;
        --tx2: -14px; --ty2: -10px;
        --tx3: -10px; --ty3: 4px;
        animation: sparkle-anim 0.9s infinite 0.7s;
    }
    .sparkle-6 {
        top: 60%; right: -14px; width: 10px; height: 10px;
        --tx1: 8px; --ty1: 4px;
        --tx2: 14px; --ty2: 10px;
        --tx3: 10px; --ty3: -4px;
        animation: sparkle-anim 1.1s infinite 0.3s;
    }

    /* Static blinking stars on button */
    .star-static {
        position: absolute;
        fill: white;
        animation: blink 0.8s steps(2, start) infinite;
    }
    .star-1 { top: 15%; left: 8%; width: 8px; height: 8px; }
    .star-2 { bottom: 15%; right: 8%; width: 6px; height: 6px; animation-delay: 0.4s; }

    .text {
        position: relative;
        z-index: 2;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .header {
      font-size: 20px;
      margin-bottom: 16px;
      font-family: 'Instrument Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      position: relative;
      z-index: 1;
      width: 100%;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .header-content {
      flex: 1;
      text-align: center;
    }

    .info-button {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #EEB52C;
      border: 1.5px solid rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      flex-shrink: 0;
      margin-left: 8px;
      font-size: 11px;
      font-weight: 700;
      color: #000;
    }

    .info-button:hover {
      background: rgba(255, 255, 255, 1);
      border-color: rgba(0, 0, 0, 0.2);
      transform: scale(1.1);
    }

    .info-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .info-modal.show {
      display: flex;
    }

    .info-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 280px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .info-content h3 {
      margin: 0 0 12px 0;
      font-size: 16px;
      font-weight: 700;
    }

    .info-content p {
      margin: 0 0 12px 0;
      font-size: 11px;
      line-height: 1.5;
      color: #666;
    }

    .info-content a {
      color: #1976d2;
      text-decoration: none;
      font-weight: 600;
    }

    .info-content a:hover {
      text-decoration: underline;
    }

    .close-modal {
      background: #000;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      font-family: 'Instrument Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
    }

    .close-modal:hover {
      background: #333;
    }

            .header h2 {

              font-size: 16px;

              font-family: 'Instrument Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;

              font-weight: 600;

              margin-bottom: 4px;

              display: flex;

              align-items: center;

              justify-content: center;

              flex-direction: column;

            }

    .header p {
      font-size: 12px;
      color: #000;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #000;
      position: relative;
      z-index: 1;
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: 12px;
      opacity: 0.3;
    }

    .colors-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      z-index: 1;
      padding-bottom: 80px;
      width: 100%;
      max-width: 100%;
    }

    .color-item {
      font-family: 'Instrument Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px;
      background-color: rgba(255, 255, 255, 0.7);
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      padding-top: 28px;
      width: 100%;
      box-sizing: border-box;
    }

    .color-item:hover {
      border-color: #EEE;
      background: #f7f9fc;
    }

    .color-swatch {
      width: 100%;
      height: 40px;
      border-radius: 4px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
      margin-top: 4px;
    }

    .color-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .color-hex-label {
      font-size: 9px;
      color: #666;
      text-transform: uppercase;
      font-weight: 400;
      letter-spacing: 0.5px;
      margin-bottom: 2px;
    }

    .color-hex {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 14px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .color-name-label {
      font-size: 9px;
      color: #666;
      text-transform: uppercase;
      font-weight: 400;
      letter-spacing: 0.5px;
    }

    .color-name {
      font-size: 11px;
      color: #000;
      display: flex;
      align-items: flex-start;
      gap: 8px;
      word-break: break-word;
      overflow-wrap: break-word;
      flex-wrap: wrap;
    }

    .color-name span:last-child {
      flex: 1;
      word-break: break-word;
      min-width: 0;
    }

    .color-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 8px 0 4px 0;
      font-size: 9px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .color-badge.variable {
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 0px 0px 4px; 
    }

    .color-badge.style {
      background: #f3e5f5;
      color: #7b1fa2;
      border-radius: 0px 0px 4px; 
    }

    .color-badge.raw {
      background: #e0e0e0; /* Light gray */
      color: #424242; /* Darker gray text */
      border-radius: 0px 0px 4px; /* Match main container's border-radius */
    }

    .badge-container {
      position: absolute;
      top: 0;
      left: 0;
    }

    .copy-icon {
      position: absolute;
      top: 8px;
      right: 12px;
      width: 20px;
      height: 20px;
      opacity: 0.7;
      flex-shrink: 0;
      transition: all 0.2s;
      padding: 4px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 4px;
    }

    .color-item:hover .copy-icon {
      opacity: 1;
      background: rgba(255, 255, 255, 1);
      transform: scale(1.1);
    }
    
    .copied-feedback {
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: #000;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s;
      border-radius: 4;
      z-index: 2000;
    }

    .copied-feedback.show {
      opacity: 0.9;
    }

    /* Background Sparkles */
    .background-sparkles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bg-sparkle {
      position: absolute;
      fill: #fbbf24; /* Gold color to match theme */
      opacity: 0.3;
      animation: bg-blink 4s steps(2, start) infinite;
    }
    
    @keyframes bg-blink {
      0%, 100% { opacity: 0.1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1); }
    }

    .bg-sparkle-1 { top: 12%; left: 8%; width: 12px; height: 12px; animation-delay: 0s; }
    .bg-sparkle-2 { top: 25%; right: 12%; width: 8px; height: 8px; animation-delay: 1.5s; }
    .bg-sparkle-3 { top: 45%; left: 15%; width: 6px; height: 6px; animation-delay: 3s; }
    .bg-sparkle-4 { bottom: 25%; right: 8%; width: 10px; height: 10px; animation-delay: 0.5s; }
    .bg-sparkle-5 { bottom: 10%; left: 20%; width: 8px; height: 8px; animation-delay: 2.5s; }
    .bg-sparkle-6 { top: 8%; right: 25%; width: 6px; height: 6px; animation-delay: 1s; }
  </style>
</head>
<body>
  <div class="background-sparkles">
      <svg class="bg-sparkle bg-sparkle-1" viewBox="0 0 8 8" shape-rendering="crispEdges">
          <path d="M3 0 h2 v3 h3 v2 h-3 v3 h-2 v-3 h-3 v-2 h3 z" />
      </svg>
      <svg class="bg-sparkle bg-sparkle-2" viewBox="0 0 8 8" shape-rendering="crispEdges">
           <path d="M2 0 h4 v2 h-4 z M0 2 h8 v4 h-8 z M2 6 h4 v2 h-4 z" />
      </svg>
      <svg class="bg-sparkle bg-sparkle-3" viewBox="0 0 4 4" shape-rendering="crispEdges">
          <path d="M1 0 h2 v1 h-2 z M0 1 h4 v2 h-4 z M1 3 h2 v1 h-2 z" />
      </svg>
      <svg class="bg-sparkle bg-sparkle-4" viewBox="0 0 8 8" shape-rendering="crispEdges">
           <path d="M2 0 h4 v2 h-4 z M0 2 h8 v4 h-8 z M2 6 h4 v2 h-4 z" />
      </svg>
      <svg class="bg-sparkle bg-sparkle-5" viewBox="0 0 8 8" shape-rendering="crispEdges">
          <path d="M3 0 h2 v3 h3 v2 h-3 v3 h-2 v-3 h-3 v-2 h3 z" />
      </svg>
      <svg class="bg-sparkle bg-sparkle-6" viewBox="0 0 4 4" shape-rendering="crispEdges">
          <path d="M1 1 h2 v2 h-2 z" />
      </svg>
  </div>
  <div class="header">
    <div class="header-content">
      <h2>
        <svg width="120px" height="80px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges" style="horizontal-align:center; margin-bottom: 4px; padding-left:20px;">
    <style>
        /* Animations embedded directly in the SVG */
        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-1px); }
        }
        @keyframes bubble-rise {
            0% { transform: translateY(0); opacity: 1; }
            50% { opacity: 1; }
            100% { transform: translateY(-4px); opacity: 0; }
        }
        @keyframes fire-flicker {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        .sparkle-1 { animation: twinkle 1.5s infinite; }
        .sparkle-2 { animation: twinkle 2s infinite 0.5s; }
        .sparkle-3 { animation: twinkle 1.8s infinite 0.2s; }
        .bubble-1 { animation: bubble-rise 2s infinite linear; }
        .bubble-2 { animation: bubble-rise 2.5s infinite linear 1s; }
        .fire-anim { animation: fire-flicker 0.2s infinite alternate; }
    </style>

    <!-- Fire (Bottom) -->
    <g class="fire-anim">
        <path fill="#e63946" d="
            M8 20 h1 v1 h-1 z
            M10 20 h1 v1 h-1 z
            M13 20 h1 v1 h-1 z
            M15 20 h1 v1 h-1 z
            M9 21 h6 v1 h-6 z
            M7 21 h1 v1 h-1 z
            M16 21 h1 v1 h-1 z
        "/>
        <path fill="#fca311" d="
            M9 20 h1 v1 h-1 z
            M11 20 h2 v1 h-2 z
            M14 20 h1 v1 h-1 z
            M10 21 h4 v1 h-4 z
        "/>
    </g>

    <!-- Cauldron Feet (Dark Grey) -->
    <path fill="#2b2d42" d="
        M7 19 h2 v1 h-2 z
        M15 19 h2 v1 h-2 z
    "/>

    <!-- Cauldron Body Main (Gold/Yellow) -->
    <path fill="#DAA520" d="
        M6 11 h12 v7 h-12 z
        M5 11 h1 v6 h-1 z
        M18 11 h1 v6 h-1 z
        M6 18 h12 v1 h-12 z
    "/>

    <!-- Cauldron Rim (Bright Yellow) -->
    <path fill="#FFD700" d="
        M5 10 h14 v1 h-14 z
        M4 10 h1 v1 h-1 z
        M19 10 h1 v1 h-1 z
    "/>
    
    <!-- Cauldron Highlight/Shading (Darker Gold) -->
    <path fill="#B8860B" d="
        M7 12 h2 v1 h-2 z
        M7 14 h1 v1 h-1 z
    "/>
    
    <!-- Potion Surface (Cyan/Blue) -->
    <path fill="#4cc9f0" d="
        M6 10 h12 v1 h-12 z
    "/>
    
    <!-- Bubbles (Purple) -->
    <rect class="bubble-1" x="9" y="8" width="1" height="1" fill="#7209b7" />
    <rect class="bubble-2" x="14" y="7" width="1" height="1" fill="#7209b7" />
    <rect x="11" y="10" width="2" height="1" fill="#7209b7" />
    <rect x="15" y="10" width="1" height="1" fill="#7209b7" />

    <!-- Sparkles (Pink/White) -->
    <g fill="#f72585">
        <g class="sparkle-1">
            <rect x="5" y="4" width="1" height="1" />
            <rect x="4" y="5" width="3" height="1" />
            <rect x="5" y="6" width="1" height="1" />
            <rect x="5" y="5" width="1" height="1" fill="#fff" />
        </g>
        <g class="sparkle-2">
            <rect x="18" y="3" width="1" height="1" />
        </g>
        <g class="sparkle-3">
            <rect x="12" y="2" width="1" height="1" />
            <rect x="11" y="3" width="3" height="1" />
            <rect x="12" y="4" width="1" height="1" />
        </g>
    </g>
</svg>
        <span>✨ Copy Spell</span>
      </h2>
      <p id="selection-info">Select an element to reveal its color values</p>
    </div>
    <div class="info-button" id="info-button">i</div>
  </div>

  <div class="info-modal" id="info-modal">
    <div class="info-content">
      <h3>About Copy Spell</h3>
      <p>Brought to you by <a href="https://www.designtokenswizards.com" target="_blank">Design Tokens Wizards</a>, Copy Spell is a magical utility designed to streamline your design token workflow.</p>
      <p>Instantly identify and copy color values from selected elements. This spell captures hex codes from Figma styles, variables, and regular fills, ensuring consistency within your design system.</p>
      <button class="close-modal" id="close-modal">Close</button>
    </div>
  </div>

  <div id="empty-state" class="empty-state">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5.5-2.5l7.51-3.49L17.5 6.5 9.99 9.99 6.5 17.5zm5.5-6.6c.61 0 1.1.49 1.1 1.1s-.49 1.1-1.1 1.1-1.1-.49-1.1-1.1.49-1.1 1.1-1.1z"/>
    </svg>
    <p>Cast your spell upon elements with fill colors</p>
  </div>

  <div id="colors-container" style="display: none;">
    <div class="colors-list" id="colors-list"></div>
    <button class="sparkle-button" id="sparkle-button">
        <div class="text">
            Cast Copy Spell
        </div>

        <!-- Pixel Art Sparkles (Reverted to classic cross/star shapes) -->
        <svg class="sparkle sparkle-1" viewBox="0 0 8 8" shape-rendering="crispEdges">
            <path d="M3 0 h2 v3 h3 v2 h-3 v3 h-2 v-3 h-3 v-2 h3 z" />
        </svg>
        <svg class="sparkle sparkle-2" viewBox="0 0 8 8" shape-rendering="crispEdges">
             <path d="M2 0 h4 v2 h-4 z M0 2 h8 v4 h-8 z M2 6 h4 v2 h-4 z" />
        </svg>
        <svg class="sparkle sparkle-3" viewBox="0 0 8 8" shape-rendering="crispEdges">
            <path d="M3 0 h2 v3 h3 v2 h-3 v3 h-2 v-3 h-3 v-2 h3 z" />
        </svg>
        <svg class="sparkle sparkle-4" viewBox="0 0 8 8" shape-rendering="crispEdges">
             <path d="M2 0 h4 v2 h-4 z M0 2 h8 v4 h-8 z M2 6 h4 v2 h-4 z" />
        </svg>
        <svg class="sparkle sparkle-5" viewBox="0 0 8 8" shape-rendering="crispEdges">
            <path d="M3 0 h2 v3 h3 v2 h-3 v3 h-2 v-3 h-3 v-2 h3 z" />
        </svg>
        <svg class="sparkle sparkle-6" viewBox="0 0 8 8" shape-rendering="crispEdges">
             <path d="M2 0 h4 v2 h-4 z M0 2 h8 v4 h-8 z M2 6 h4 v2 h-4 z" />
        </svg>

        <!-- Static Pixel Stars -->
        <svg class="star-static star-1" viewBox="0 0 4 4" shape-rendering="crispEdges">
            <path d="M1 0 h2 v1 h-2 z M0 1 h4 v2 h-4 z M1 3 h2 v1 h-2 z" />
        </svg>
        <svg class="star-static star-2" viewBox="0 0 4 4" shape-rendering="crispEdges">
            <path d="M1 1 h2 v2 h-2 z" />
        </svg>
    </button>
  </div>

  <div class="copied-feedback" id="copied-feedback">Values captured!</div>

  <script>
    let currentColors = [];

    // Handle messages from plugin code
    onmessage = (event) => {
      const msg = event.data.pluginMessage;

      if (msg.type === 'colors-updated') {
        currentColors = msg.colors;
        updateUI(msg.colors, msg.selectionCount);
      }
    };

    function updateUI(colors, selectionCount) {
      totalSelectedElementsCount = selectionCount;
      const emptyState = document.getElementById('empty-state');
      const container = document.getElementById('colors-container');
      const selectionInfo = document.getElementById('selection-info');
      const colorsList = document.getElementById('colors-list');

      if (colors.length === 0) {
        emptyState.style.display = 'block';
        container.style.display = 'none';
        selectionInfo.textContent = selectionCount === 0
          ? 'Select an element to reveal its color magic'
          : `${selectionCount} element(s) selected - no color magic detected`;
      } else {
        emptyState.style.display = 'none';
        container.style.display = 'block';
        selectionInfo.textContent = `${colors.length} color(s) discovered in ${selectionCount} element(s)`;

        // Clear and rebuild colors list
        colorsList.innerHTML = '';
        colors.forEach(color => {
          const item = createColorItem(color);
          colorsList.appendChild(item);
        });
      }
    }

    function createColorItem(colorData) {
      const item = document.createElement('div');
      item.className = 'color-item';

      // Copy only the value (hex or CSS string) to ensure it's valid code
      const textToCopy = colorData.hex;
      item.onclick = () => copyColor(textToCopy, colorData.hex);

      const colorInfo = document.createElement('div');
      colorInfo.className = 'color-info';

      // Add badge on top if available (style, variable, or raw)
      if (colorData.type || (!colorData.name && !colorData.isGradient)) { // Check for raw color if no name and not a gradient
        const badgeContainer = document.createElement('div');
        badgeContainer.className = 'badge-container';
        const badge = document.createElement('span');
        
        if (colorData.type) {
            badge.className = `color-badge ${colorData.type}`;
            badge.textContent = colorData.type;
        } else if (!colorData.name) { // It's a raw color if no type and no name
            badge.className = `color-badge raw`;
            badge.textContent = 'raw color';
        }
        
        badgeContainer.appendChild(badge);
        colorInfo.appendChild(badgeContainer);
      }

      const hexLabel = document.createElement('div');
      hexLabel.className = 'color-hex-label';
      hexLabel.textContent = colorData.isGradient ? 'CSS Value' : 'Hex Code';
      colorInfo.appendChild(hexLabel);

      const hexText = document.createElement('div');
      hexText.className = 'color-hex';
      hexText.textContent = colorData.hex;
      
      if (colorData.isGradient) {
        hexText.style.fontSize = '11px';
        hexText.style.fontWeight = '400';
        hexText.style.whiteSpace = 'normal';
        hexText.style.wordBreak = 'break-all';
        hexText.style.lineHeight = '1.4';
      }
      
      colorInfo.appendChild(hexText);

      // Add color name section if available
      if (colorData.name) {
        const nameLabel = document.createElement('div');
        nameLabel.className = 'color-name-label';
        nameLabel.textContent = 'Color Name';
        colorInfo.appendChild(nameLabel);

        const nameContainer = document.createElement('div');
        nameContainer.className = 'color-name';
        const nameText = document.createElement('span');
        nameText.textContent = colorData.name;
        nameContainer.appendChild(nameText);
        colorInfo.appendChild(nameContainer);
      }

      // Color swatch below the color name
      const swatch = document.createElement('div');
      swatch.className = 'color-swatch';
      swatch.style.background = colorData.hex;
      colorInfo.appendChild(swatch);

      const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      icon.setAttribute('class', 'copy-icon');
      icon.setAttribute('viewBox', '0 0 16 16');
      icon.setAttribute('fill', 'currentColor');
      icon.innerHTML = '<path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>';

      item.appendChild(colorInfo);
      item.appendChild(icon);

      return item;
    }

    function copyColor(text, displayText) {
      copyToClipboard(text)
        .then(() => {
          showCopiedFeedback(`Casted ${displayText || text}`);
          // parent.postMessage({ pluginMessage: { type: 'copy-color', color: displayText || text } }, '*');
        })
        .catch((err) => {
          console.error('Failed to copy:', err);
          parent.postMessage({ pluginMessage: { type: 'copy-error', error: err.message } }, '*');
        });
    }

    function copyAllColors() {
      if (currentColors.length === 0) return;

      const text = currentColors.map(c =>
        c.name ? `${c.hex}, ${c.name}` : c.hex
      ).join('\n');

      copyToClipboard(text)
        .then(() => {
          showCopiedFeedback(`Copied ${currentColors.length} colors!`);
          // parent.postMessage({
          //   pluginMessage: { type: 'copy-all', count: currentColors.length }
          // }, '*');
        })
        .catch((err) => {
          console.error('Failed to copy:', err);
          parent.postMessage({ pluginMessage: { type: 'copy-error', error: err.message } }, '*');
        });
    }

    function copyToClipboard(text) {
      // Try multiple methods to ensure compatibility
      if (navigator.clipboard && navigator.clipboard.writeText) {
        return navigator.clipboard.writeText(text);
      } else {
        // Fallback method using textarea
        return new Promise((resolve, reject) => {
          const textarea = document.createElement('textarea');
          textarea.value = text;
          textarea.style.position = 'fixed';
          textarea.style.opacity = '0';
          document.body.appendChild(textarea);
          textarea.focus();
          textarea.select();

          try {
            const successful = document.execCommand('copy');
            document.body.removeChild(textarea);
            if (successful) {
              resolve();
            } else {
              reject(new Error('Copy command failed'));
            }
          } catch (err) {
            document.body.removeChild(textarea);
            reject(err);
          }
        });
      }
    }

    function showCopiedFeedback(text) {
      const feedback = document.getElementById('copied-feedback');
      feedback.textContent = `✨ ${text}!`;
      feedback.classList.add('show');
      setTimeout(() => {
        feedback.classList.remove('show');
      }, 2000);
    }

    // Setup copy all button
    document.getElementById('sparkle-button').onclick = copyAllColors;

    // Setup info modal
    const infoButton = document.getElementById('info-button');
    const infoModal = document.getElementById('info-modal');
    const closeModal = document.getElementById('close-modal');

    infoButton.onclick = () => {
      infoModal.classList.add('show');
    };

    closeModal.onclick = () => {
      infoModal.classList.remove('show');
    };

    infoModal.onclick = (e) => {
      if (e.target === infoModal) {
        infoModal.classList.remove('show');
      }
    };

    // Request initial colors
    parent.postMessage({ pluginMessage: { type: 'get-colors' } }, '*');
  </script>
</body>
</html>
